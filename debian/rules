#!/usr/bin/make -f

CONFIG = n900_defconfig
DTB    = omap3-n900.dtb
DEV    = n900
ARCH   = arm

ifneq (,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
	NUMJOBS = $(patsubst parallel=%,%,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
	BUILD_FLAGS += -j$(NUMJOBS)
endif

ifneq ($(DEB_BUILD_GNU_TYPE),$(DEB_HOST_GNU_TYPE))
	BUILD_FLAGS += CROSS_COMPILE=$(DEB_HOST_GNU_TYPE)-
endif

build-arch:
	$(MAKE) ARCH=$(ARCH) $(CONFIG)
	$(MAKE) ARCH=$(ARCH) $(BUILD_FLAGS) zImage modules $(DTB)

binary-arch:
ifeq ($(DEB_BUILD_GNU_TYPE),$(DEB_HOST_GNU_TYPE))
	$(MAKE) ARCH=$(ARCH) DEV=$(DEV) DTB=$(DTB) $(BUILD_FLAGS) intdeb-pkg
else
	$(MAKE) ARCH=$(ARCH) $(BUILD_FLAGS) HOSTCC=$(DEB_HOST_GNU_TYPE)-gcc modules
	$(MAKE) ARCH=$(ARCH) DEV=$(DEV) DTB=$(DTB) $(BUILD_FLAGS) \
		HOSTCC=$(DEB_HOST_GNU_TYPE)-gcc intdeb-pkg
endif

clean:
	rm -rf debian/*tmp debian/files
	$(MAKE) mrproper

build:  build-arch
binary: binary-arch
